<!DOCTYPE html>
<html>
<head>
    <title>cockpit vote</title>
    <style>
        body {
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
            padding: 20px;
        }
        img {
            width: auto;
            height: 400px;
            border-radius: 10px;
        }
        .image-container {
            position: relative;
            display: inline-block;
            margin: 0 10px;
        }
        .overlay-btn {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
            background: transparent;
            color: white;
            font-size: 1.5em;
            font-weight: bold;
            opacity: 0;
            transition: background 0.2s ease, opacity 0.2s ease;
            cursor: pointer;
            border-radius: 10px;
        }
        .overlay-btn:hover {
            background: rgba(0, 0, 0, 0.4);
            opacity: 1;
        }
        .overlay-btn:active {
            background: rgba(0, 0, 0, 0.7);
            opacity: 1;
        }
        #currentPair {
            display: flex;
            gap: 20px;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
        }
        /* On vertical (narrow) screens, stack vertically */
        @media (max-width: 600px) {
            #currentPair {
                flex-direction: column;
                gap: 10px;
            }
            img {
                width: auto;
                height: 200px;
                border-radius: 10px;
            }
        }
    </style>
</head>
<body>

<h1>
  <b style="color:#d60270">COCK</b><b style="color:#9b4f96">PIT</b><b style="color:#0038a8">VOTE</b>
</h1>

<div id="arrayDisplay">Loading...</div>
<h2>
    <b style="color:red">WARNING: CHANGES ARE NO LONGER GLOBALLY SAVED AND ARE LOST ON SERVER RESET</b>
    <b style="color:red"> Thank a certain James Butcher for nearly getting my integration banned</b>
</h2>

<div id="currentPair" style="display:flex; gap:20px; justify-content:left; align-items:center;">
    <div id="leftImage" class="image-container"></div>
    <div id="rightImage" class="image-container"></div>
</div>

<script>
const socket = new WebSocket('wss://cockpitserver.onrender.com');
let currentPair = null;

const imageDictionary = {
    1: 'kevin.jpg',
    2: 'soren.jpg',
    3: 'lucas.jpg',
    4: 'matt.jpg',
    5: 'alex.jpg',
    6: 'bowen.jpg',
    7: 'ellen.jpg',
    8: 'nate.jpg',
    9: 'michael.jpg',
    10: 'james.jpg',
    11: 'jem.jpg',
    12: 'rishav.jpg',
};

socket.onmessage = event => {
    const data = JSON.parse(event.data);

    if (data.type === 'array_update') {
        displayArray(data.data);
    }

    if (data.type === 'new_pair') {
        currentPair = data.data;
        renderPair(currentPair);
    }
};

socket.onopen = () => {
    socket.send(JSON.stringify({ type: 'request_array' }));

    // keepalive ping
    setInterval(() => {
        if (socket.readyState === 1) {
            socket.send(JSON.stringify({ type: 'ping' }));
            console.log("ping");
        }
    }, 30000);
};

function displayArray(pics) {
    let sorted = [...pics].sort((a, b) => b[1] - a[1]);
    const container = document.getElementById('arrayDisplay');
    container.innerHTML = "<h3>Current Rankings:</h3><ul>";
    for (const [id, elo] of sorted) {
        const filename = imageDictionary[id] || `Unknown (ID: ${id})`;
        container.innerHTML += `<li><strong>${filename}</strong> â€” Elo: ${elo.toFixed(1)}</li>`;
    }
    container.innerHTML += "</ul>";
}

function renderPair(pair) {
    const { gA, gB } = pair;
    document.getElementById('leftImage').innerHTML = `
        <img src="${imageDictionary[gA]}" alt="Image ${gA}">
        <button class="overlay-btn" onclick="handleChoice('l')">this one</button>
    `;
    document.getElementById('rightImage').innerHTML = `
        <img src="${imageDictionary[gB]}" alt="Image ${gB}">
        <button class="overlay-btn" onclick="handleChoice('r')">this one</button>
    `;
}

function handleChoice(choice) {
    if (!currentPair) return;
    socket.send(JSON.stringify({ type: 'choice', data: choice }));
}
</script>

</body>
